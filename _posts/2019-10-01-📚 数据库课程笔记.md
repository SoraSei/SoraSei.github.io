---
layout: post
title: ğŸ“š æ•°æ®åº“è¯¾ç¨‹ç¬”è®°
img: header_post.jpg
tags: [mongoDB, postgreSQL, ğŸ“š]
---

- [mongoDB](#mongodb)
  - [å¢åˆ æ”¹æŸ¥](#å¢åˆ æ”¹æŸ¥)
- [postgreSQL](#postgresql)
  - [å¢åˆ æ”¹æŸ¥](#å¢åˆ æ”¹æŸ¥-1)
  - [å­—æ®µ ç´¢å¼• è§†å›¾ äº‹åŠ¡](#å­—æ®µ-ç´¢å¼•-è§†å›¾-äº‹åŠ¡)

---

# mongoDB

- é»˜è®¤
- å¢åˆ æ”¹æŸ¥

```bash
$ brew tap mongodb/brew
$ brew install mongodb-community

$ brew services start mongodb-community # åå°å¯åŠ¨ï¼Œwin ç³»ç»Ÿ net start mongodb
$ brew services stop mongodb-community # åå°åœæ­¢ï¼Œwin ç³»ç»Ÿ net stop mongodb

$ mongod --config /usr/local/etc/mongod.conf # æ‰‹åŠ¨å¯åŠ¨ï¼Œmongod.conf ä¸ºè®¾ç½®
$ mongo admin --eval "db.shutdownServer()" # æ‰‹åŠ¨åœæ­¢

$ mongodump -d dbname # å¤‡ä»½ï¼Œbson æ ¼å¼ï¼Œ-d ä¸ºå¤‡ä»½æ•°æ®åº“ï¼Œ-c ä¸ºå¤‡ä»½é›†åˆ
$ mongorestore # æ¢å¤æ•°æ®åº“

$ mongo dbname # è¿›å…¥(æŸ)æ•°æ®åº“ï¼Œæ•°æ®åº“åå¯é€‰
# æ•°æ® /usr/local/var/mongodb
# æ—¥å¿— /usr/local/var/log/mongodb

> show dbs; # æ‰€æœ‰æ•°æ®åº“ï¼Œåˆå§‹ adminã€configã€local
> exit
```

## å¢åˆ æ”¹æŸ¥

```bash
> use blog; # æ–°å»º/è¿›å…¥æŸæ•°æ®åº“
> show collections; # æ‰€æœ‰é›†åˆ
> db.stats(); # æ•°æ®åº“ä¿¡æ¯
> db.dropDatabase(); # åˆ é™¤æ•°æ®åº“

> db.createCollection('users'); # æ–°å»ºé›†åˆ
> db.users.renameCollection('posts'); # é›†åˆæ”¹å
> db.posts.drop(); # åˆ é™¤é›†åˆ
> db.posts.count(); # æ–‡æ¡£æ•°

# å¾ªç¯æ’å…¥æ–‡æ¡£ï¼Œè‡ªåŠ¨ç”Ÿæˆ _id å’Œ __v
> for (var i = 1; i <= 10; i++) { db.posts.insert({ title: 'ç¬¬' + i + 'ç¯‡åšå®¢', tag: ['æœªåˆ†ç±»'] }); }

# åˆ é™¤æ–‡æ¡£ï¼Œ{} ä¸ºæ¸…ç©ºé›†åˆ
> db.posts.remove({ title: 'æ–°æ–‡ç« ' });

# å­—æ®µçš„æ‰€æœ‰å€¼ï¼Œset ç±»å‹æ— é‡å¤
> db.posts.distinct('tag');

# ä¸”æ¡ä»¶ï¼Œæ¥æ”¶æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚ /k/ ä¸ºå«kï¼Œ/^k/ ä¸ºä»¥kå¼€å¤´
# $gte ä¸º >=ï¼Œ$gt ä¸º >
# $lte ä¸º <=ï¼Œ$lt ä¸º <
# $eq ä¸º =ï¼Œ$ne ä¸º !=
> db.posts.find({ 'tag': 'game', 'title': /u/, 'rank': { $gte: 5 } });

# æˆ–æ¡ä»¶
# $in æšä¸¾ï¼Œ$exists å­˜åœ¨åˆ¤æ–­
> db.posts.find({ $or: [{ 'title': /u/ }, { 'rank': { $in: [3, 4] }, { 'istop': { $exists: true } } }] });

# æŸ¥æ‰¾ï¼Œç©ºå‚æ•° () ä¸ºæ‰€æœ‰æ–‡æ¡£ï¼Œå‚æ•°ä¸ºæ¡ä»¶å’Œæ˜¾ç¤ºé€‰å®šå­—æ®µ
# 1 æ˜¾ç¤º 0 ä¸æ˜¾ç¤ºï¼Œ_id é»˜è®¤æ˜¾ç¤º
# æ’åº sort()ï¼Œ1 æ­£åº -1 å€’åºï¼Œå­—æ®µä¸å­˜åœ¨æ’åºä¸º 0 æœ€å°
# å–å‰æ’ limit()ï¼Œè·³è¿‡å‰æ’ skip()ï¼Œå¸¸ç”¨äºç¿»é¡µ
> db.posts.find({}, { title: true, rank: 1, _id: 0 }).sort({ rank: -1 }).skip(3).limit(3);
# ç›¸å½“äº limit(1)ï¼Œé»˜è®¤æ›´æ–°é¡ºåºï¼Œå³ _id æ­£åº
> db.posts.findOne({}, { _id: 0 });

# é»˜è®¤æ›´æ–°ç¬¬ 1 æ¡æŸ¥è¯¢ï¼Œå³ findOne() æ–¹å¼
# multi æ›´æ–°æ‰€æœ‰ï¼Œå³ find() æ–¹å¼
# $set æ›´æ–°æŒ‡å®šå­—æ®µ(æ–°å¢æˆ–ä¿®æ”¹)
> db.posts.update({ 'tag': 'it' }, { $set: { 'rank': 60 } }, { multi: true });

# $inc å­—æ®µå€¼ç›¸åŠ ï¼Œ$mul å­—æ®µå€¼ç›¸ä¹˜
> db.posts.update({ 'tag': 'it' }, { $inc: { rank: 1 } });
# $rename å­—æ®µæ”¹å
> db.posts.update({ 'tag': 'it' }, { $rename: { 'rank': 'score' } });
# $unset åˆ é™¤å­—æ®µ
> db.posts.update({ 'tag': 'it' }, { $unset: { 'istop': true } });
# upsert æœ‰æŸ¥è¯¢ç»“æœåˆ™æ›´æ–°ï¼Œæ— åˆ™è¿½åŠ 
> db.posts.update({ title: 'æ–°æ–‡ç« ' }, { title: 'æ–°æ–‡ç« ', 'rank': 5 }, { upsert: true });

# æŸ¥è¯¢ç´¢å¼•ï¼Œé»˜è®¤ {_id:1} ç´¢å¼•ï¼Œ1 æ­£åº -1 å€’åº
> db.posts.getIndexes();
> db.posts.createIndex({ title: 1 }, { unique: true }); # æ–°å»ºç´¢å¼•
> db.posts.dropIndex({ rank: -1 }); # åˆ é™¤ç´¢å¼•
```

# postgreSQL

- å¢åˆ æ”¹æŸ¥
- å­—æ®µ ç´¢å¼• è§†å›¾ äº‹åŠ¡

## å¢åˆ æ”¹æŸ¥

```bash
$ sudo apt-get install postgresql # å®‰è£…

$ sudo su postgres # åˆ‡æ¢ç”¨æˆ·åˆ° postgresï¼Œç³»ç»Ÿç®¡ç†å‘˜

$ psql -l # æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“
$ createdb komablog # ç³»ç»Ÿå‘½ä»¤ï¼Œå»ºç«‹æ•°æ®åº“
$ dropdb komablog # ç³»ç»Ÿå‘½ä»¤ï¼Œåˆ é™¤æ•°æ®åº“

$ psql komablog # åˆ‡æ¢åˆ°æ•°æ®åº“
> \l # åˆ—è¡¨
> \q # é€€å‡º

> select now(); # æ•°æ®åº“æ—¶é—´ï¼Œç‰ˆæœ¬ version()

> create table posts (title varchar(255), content text); # åˆ›å»ºè¡¨
> alter table posts rename to komaposts; # æ”¹å
> drop table komaposts; # åˆ é™¤è¡¨

> \dt # å½“å‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨
> \dv # å½“å‰æ•°æ®åº“çš„æ‰€æœ‰è§†å›¾
> \d posts # æŒ‡å®šè¡¨çš„æ‰€æœ‰å­—æ®µ

> \i db.sql # å¯¼å…¥ sql æ–‡ä»¶ï¼Œå†…å®¹ sql å‘½ä»¤å¦‚ create table posts...
```

```sql
-- å»ºè¡¨çº¦æŸ
create table users (
    id serial primary key, -- primary key ç›¸å½“äº not null å’Œ uniqueï¼Œå³ä¸»é”®
    player varchar(255) not null, score real, team varchar(255),
    content text check(length(content) > 8), -- check å­—æ®µæ¡ä»¶
    created_date timestamp default 'now' -- default å­—æ®µé»˜è®¤å€¼
);

insert into users (player, score, team) values ('åº“é‡Œ', 28.3, 'å‹‡å£«'), ('å“ˆç™»', 30.2, 'ç«ç®­');

select * from users; -- /x åˆ‡æ¢æ¨ªå‘çºµå‘æ˜¾ç¤º
select player, score from users where score > 20 and score < 30 and team != 'å‹‡å£«';
select * from users where player like '_é˜¿%'; -- _ ä¸º 1 ä¸ªå­—ç¬¦ï¼Œ% ä¸º 1 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦

-- order by æŒ‰æŸå­—æ®µæ’åº(é»˜è®¤æ­£åº)
-- limit å–å‰æ’ç»“æœ
-- offset è·³è¿‡å‰æ’ç»“æœ
select * from users order by team, score desc limit 3 offset 4;

-- è¿‡æ»¤é‡å¤æ•°æ®
select distinct team from users;
-- å’Œ
select sum(score) from users;
-- æœ€å¤§æœ€å°
select * from users where score = (select max(score) from users);
-- having ç›¸å½“äº where
select team, max(score) from users group by team having max(score) >= 25 order by max(score);

-- å­—ç¬¦ä¸²é•¿åº¦ length()
-- è¿æ¥ concat()
-- æˆªå– substring()
-- éšæœºæ’åº random()ï¼Œas ä¸ºåˆ«å
select player, length(player), concat(player, '/', team) as 'çƒå‘˜ä¿¡æ¯', substring(team, 1, 1) as 'çƒé˜Ÿé¦–æ–‡å­—' from users order by random() limit 1;

update users set score = score + 100 where team in ('å‹‡å£«', 'éª‘å£«');

-- ç‰©ç†åˆ é™¤
delete from users where score > 30;

-- å¤–è”
select u.player, t.content from users as u, twitters as t where u.id = t.user_id and u.id = 1;
```

## å­—æ®µ ç´¢å¼• è§†å›¾ äº‹åŠ¡

```sql
alter table users add fullname varchar(255); -- æ·»åŠ å­—æ®µ
alter table users drop fullname; -- åˆ é™¤å­—æ®µ
alter table users rename player to nba_player; -- æ®µåæ”¹åï¼Œrename to ä¸ºè¡¨æ”¹å
alter table users alter nba_player type varchar(100); -- å­—æ®µæ”¹ç±»å‹

create index nba_player_index on users(nba_player); -- æ·»åŠ ç´¢å¼•
drop index nba_player_index; -- åˆ é™¤ç´¢å¼•

create view curry_twitters as select u.player, t.content from users as u, twitters as t where u.id = t.user_id and u.id = 1; -- æ·»åŠ è§†å›¾ï¼Œcreate view as åä¸º select è¯­å¥
select * from curry_twitters; -- æ˜¾ç¤ºè§†å›¾
drop view curry_twitters; -- åˆ é™¤è§†å›¾

begin; /* å¢åˆ æ”¹æŸ¥æ“ä½œ */ commit; -- äº‹ç‰©æ‰§è¡Œ
begin; /* å¢åˆ æ”¹æŸ¥æ“ä½œ */ rollback; -- äº‹ç‰©å›æ»š
```
