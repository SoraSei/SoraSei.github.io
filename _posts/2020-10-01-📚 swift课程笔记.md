---
layout: post
title: ğŸ“š swiftè¯¾ç¨‹ç¬”è®°
img: header_post.jpg
tags: [swift, ğŸ“š]
---

- [åŸºç¡€](#åŸºç¡€)
- [å›¾ç‰‡ç¼©æ”¾](#å›¾ç‰‡ç¼©æ”¾)
- [å±æ€§åŒ…è£…å™¨](#å±æ€§åŒ…è£…å™¨)
- [æ•°æ®ç»‘å®š @State](#æ•°æ®ç»‘å®š-state)
- [æ•°æ®ç»‘å®š @Binding](#æ•°æ®ç»‘å®š-binding)
- [ç³»ç»Ÿæ•°æ® @Environment](#ç³»ç»Ÿæ•°æ®-environment)
- [è§‚å¯Ÿè€…æ•°æ®ç»‘å®š](#è§‚å¯Ÿè€…æ•°æ®ç»‘å®š)
- [è®¿é—®ç¯å¢ƒå¯¹è±¡](#è®¿é—®ç¯å¢ƒå¯¹è±¡)
- [combine](#combine)

# åŸºç¡€

```swift
import SwiftUI
struct ContentView: View {
    var body: some View {
        NavigationView {
            List(0 ..< 20) { item in
                NavigationLink(destination: Text("Detail")) {
                    Image(systemName: "heart")
                        .resizable()
                        .foregroundColor(.red)
                        .frame(width: 50.0, height: 50)
                    VStack(alignment: .leading, spacing: 0) {
                        Text("Hello, World!")
                        Text("Detail")
                    }
                }
            }
            .navigationBarTitle(Text("Navigation Bar"))
        }
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

# å›¾ç‰‡ç¼©æ”¾

```swift
import SwiftUI
struct ContentView: View {
    @State private var zoomed: Bool = false // @StateçŠ¶æ€ç®¡ç†
    var body: some View {
        ZStack(alignment: self.zoomed ? .top : .topTrailing) {
            Image("trover")
                .resizable()
                .aspectRatio(contentMode: self.zoomed ? .fill : .fit)
                .navigationBarTitle(Text("å´”ä½›"), displayMode: .inline)
                .onTapGesture {
                    withAnimation {
                        self.zoomed = !self.zoomed
                    }
            }
            Image("xiaoma")
                .resizable()
                .frame(width: 50, height: 50, alignment: .center)
                .padding(.all, 10)
        }
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        NavigationView {
            ContentView()
        }
    }
}
```

# å±æ€§åŒ…è£…å™¨

```swift
@propertyWrapper
struct ClamppedValue {
    private var storedValue: Int = 0
    var wrappedValue: Int {
        get {
            return self.storedValue
        }
        set {
            if newValue < 0 {
                self.storedValue = 0
            } else if newValue > 255 {
                self.storedValue = 255
            } else {
                self.storedValue = newValue
            }
        }
    }
    init(wrappedValue initialValue: Int) {
        self.wrappedValue = initialValue
    }
}
struct MyColor {
    @ClamppedValue var red: Int
    @ClamppedValue var green: Int
    @ClamppedValue var blue: Int
}
let color: MyColor = MyColor(red: 50, green: 500, blue: 50)
print("color.red is \(color.red)")
print("color.green is \(color.green)")
print("color.blue is \(color.blue)")
```

# æ•°æ®ç»‘å®š @State

```swift
import SwiftUI
struct ContentView: View {
    @State private var title: String = "Helo Title."
    @State private var textInput: String = ""
    var body: some View {
        VStack {
            Text(self.title)
                .font(.title)
            TextField("placeholder", text: self.$textInput)
                .font(.title)
                .frame(height: 50)
                .padding(.horizontal, 10)
                .textFieldStyle(RoundedBorderTextFieldStyle())
            Button(action: {
                print("action:", self.textInput)
                self.title = self.textInput
            }) {
                Text("ç¡®å®š")
                    .font(.largeTitle)
                    .padding()
            }
        }
        .padding()
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

# æ•°æ®ç»‘å®š @Binding

```swift
import SwiftUI
struct HeaderView: View {
    @Binding var title: String
    var counter: Int = 0
    init(title: Binding<String>) {
        self._title = title
        let sentence = self._title.wrappedValue
        counter = sentence.count
    }
    var body: some View {
        Text(self.title + "/\(counter)")
            .font(.title)
    }
}
struct ContentView: View {
    @State private var title: String = "App Title"
    var body: some View {
        VStack {
            HeaderView(title: self.$title)
            Button(action: {
                self.title = "New App Title"
            }) {
                Text("ç¡®å®š")
                    .font(.largeTitle)
                    .padding()
            }
        }
        .padding()
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

# ç³»ç»Ÿæ•°æ® @Environment

```swift
import SwiftUI
struct ContentView: View {
    @Environment(\.colorScheme) var mode
    var body: some View {
        VStack {
            Text("Mode: \(mode == .dark ? "Dark" : "Light")")
            Text("Hello, World!")
                .padding(40)
                .background(mode == .dark ? Color.black : Color.yellow)
                .foregroundColor(mode == .dark ? Color.yellow : Color.black)
        }
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}
```

# è§‚å¯Ÿè€…æ•°æ®ç»‘å®š

```swift
// AppData.swift: ObservableObject @Published
import SwiftUI
class AppData: ObservableObject {
    @Published var AppTitle: String = "SwiftUIæ•™å­¦"
    @Published var Author: String = "koma"
}

// AppDelegate.swift
var appData: AppData!
func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    self.appData = AppData()
    return true
}

// SceneDelegate.swift
func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
    // Create the SwiftUI view that provides the window contents.
    let app = UIApplication.shared
    let delegate = app.delegate as! AppDelegate
    let contentView = ContentView(appData: delegate.appData)

// ContentView.swift: @ObservedObject
import SwiftUI
struct ContentView: View {
    @ObservedObject var appData: AppData
    var body: some View {
        VStack {
            Text(self.appData.AppTitle)
                .bold()
                .font(.largeTitle)
            Text(self.appData.Author)
                .bold()
                .font(.title)
                .foregroundColor(.gray)
            Divider()
            Button(action: {
                self.appData.Author = "xiaoma"
            }) {
                Text("æ›´æ–°")
                    .padding()
                    .font(.system(size: 30))
            }
        }
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView(appData: AppData())
    }
}
```

# è®¿é—®ç¯å¢ƒå¯¹è±¡

```swift
// AppData.swift
import SwiftUI
class AppData: ObservableObject {
    @Published var AppTitle: String = "SwiftUIæ•™å­¦"
    @Published var Author: String = "Koma"
}

// AppDelegate.swift
var appData: AppData!
func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
    self.appData = AppData()
    return true
}

// SceneDelegate.swift
func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
    let app = UIApplication.shared
    let delegate = app.delegate as! AppDelegate
    let contentView = ContentView()
        .environmentObject(delegate.appData)

// ContentView.swift
import SwiftUI
struct ContentView: View {
    @EnvironmentObject var appData: AppData
    var body: some View {
        VStack {
            Text(self.appData.AppTitle)
            Text(self.appData.Author)
        }
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView().environmentObject(AppData())
    }
}
```

# combine

- ç®€å•çš„å‘å¸ƒäºæ¥æ”¶æ•°æ®æµ

```swift
import Combine
// å‘é€æ•´æ•°å‹æ•°å€¼42
let publisher = Just(10)
// é€šè¿‡è®¢é˜…è€…æ¥å—å‘å¸ƒè€…çš„æ•°æ®
let subscriber = Subscribers.Sink<Int, Never>(
    receiveCompletion: { completion in
        switch completion {
        case .failure(let error):
            print(error)
        case .finished:
            print("ç¨‹åºç»“æŸ")
        }
    },
    receiveValue: { value in
        print("æ”¶åˆ°ï¼š\(value)")
    }
)
// è¿æ¥è®¢é˜…å’Œå‘å¸ƒè€…ï¼Œå®Œæˆæ•°æ®æµä¼ é€ä¸æ¥å—
publisher.subscribe(subscriber)

// ç®€å•çš„å®ç°
Just(20).sink(
    receiveCompletion: { completion in
        switch completion {
        case .failure(let error):
            print(error)
        case .finished:
            print("ç¨‹åºç»“æŸ")
        }
    },
    receiveValue: { value in
        print("æ”¶åˆ°ï¼š\(value)")
    }
)
Just(30).sink(
    receiveValue: { value in
        print("æœ€ç®€å•çš„æ¥æ”¶ï¼š\(value)")
    }
)
let cancellable = Just(40).sink(
    receiveValue: { value in
        print("æœ€ç®€å•çš„æ¥æ”¶ï¼š\(value)")
    }
)
```

- å‘å¸ƒè€…ç›´æ¥é€šè¿‡è·¯å¾„(KeyPath)æ–¹å¼åˆ†é…æ•°æ®æµ

```swift
import Combine
class TestResult {
    var score: Int
    init(score: Int) {
        self.score = score
    }
}
let myTestResult = TestResult(score: 0)
print("æˆ‘çš„è€ƒè¯•ç»“æœæ˜¯ï¼š\(myTestResult.score)")
let cancellable = Just(100).assign(to: \.score, on: myTestResult)
print("é‡æ–°åˆ¤åˆ†åç»“æœï¼š\(myTestResult.score)")

// å½“å‘é€ä¸æ¥æ”¶çš„æ•°æ®æµç±»å‹ä¸ä¸€è‡´çš„æ—¶å€™
Just("99")
    .map({ value in
        return Int(value)!
    })
    .assign(to: \.score, on: myTestResult)
print("æ–‡æœ¬åˆ¤åˆ†åç»“æœï¼š\(myTestResult.score)")
```

- æ¶ˆæ¯ä¸­å¿ƒ(NotificationCenter)æ–¹å¼å¤„ç†æ•°æ®æµ

```swift
import Foundation
import Combine
extension Notification.Name {
    static let finishCalc = Notification.Name("finisheCalc")
}
class TestResult {
    var score: Int
    init(score: Int) {
        self.score = score
    }
}
let myTestResult = TestResult(score: 0)
print("æˆ‘çš„è€ƒè¯•ç»“æœæ˜¯ï¼š\(myTestResult.score)")

let cancellable = NotificationCenter.default.publisher(
    for: .finishCalc,
    object: nil
    )
    .map({ notification in
        return notification.userInfo?["result"] as? Int ?? 0
    })
    .assign(to: \.score, on: myTestResult)

// é‡æ–°åˆ¤åˆ†å¤„ç†
NotificationCenter.default.post(
    name: .finishCalc,
    object: nil,
    userInfo: ["result": 85]
)
print("é‡æ–°åˆ¤åˆ†åç»“æœï¼š\(myTestResult.score)")
```
