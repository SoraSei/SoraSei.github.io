---
layout: post
title: ğŸ“š jsåº”ç”¨ç¬”è®°
img: header_post.jpg
tags:
  - js
  - puppeteer
  - fastify
  - express-graphql
  - deno
  - adonisjs
  - canvas
  - chartjs
  - unirest
  - nginx
  - ğŸ“š
---

- [è‡ªåŠ¨åŒ– puppeteer](#è‡ªåŠ¨åŒ–-puppeteer)
  - [è·å–è¯·æ±‚](#è·å–è¯·æ±‚)
  - [æˆªå›¾](#æˆªå›¾)
- [ç½‘ç«™ fastify](#ç½‘ç«™-fastify)
- [ç½‘ç«™ express-graphql](#ç½‘ç«™-express-graphql)
- [ç½‘ç«™ deno](#ç½‘ç«™-deno)
- [ç½‘ç«™ adonisjs](#ç½‘ç«™-adonisjs)
- [ç½‘é¡µ canvas](#ç½‘é¡µ-canvas)
- [å›¾è¡¨ chartjs](#å›¾è¡¨-chartjs)
- [æ”¶é›†èµ„æ–™ unirest](#æ”¶é›†èµ„æ–™-unirest)
- [æœåŠ¡å™¨ nginx](#æœåŠ¡å™¨-nginx)

---

# è‡ªåŠ¨åŒ– puppeteer

- é»˜è®¤
- è·å–è¯·æ±‚
- æˆªå›¾

```js
const puppeteer = require("puppeteer");

let options = {
  headless: true, // æ— ç•Œé¢
  slowMo: 250, // è°ƒè¯•æ—¶å‡æ…¢é€Ÿåº¦
  defaultViewport: { width: 1200, height: 800 },
  timeout: 3000,
};
let browser = await puppeteer.launch(options); // æ‰“å¼€æµè§ˆå™¨
let page = await browser.newPage(); // æ‰“å¼€æ–°æ ‡ç­¾
let pages = await browser.pages(); // è·å–æ‰€æœ‰é¡µé¢
browser.close(); // å…³é—­æµè§ˆå™¨

await page.goto(url); // é¡µé¢è·³è½¬

let btn = await page.$(selector); // è·å–é¡µé¢å¯¹è±¡
let input = await page.$(selector);
btn.click(); // ç‚¹å‡»
input.forcus(); // èšç„¦
await page.keyboard.type("Hello"); // é”®ç›˜æ“ä½œ, åŒç† press() down()
await page.mouse.move(0, 0); // é¼ æ ‡æ“ä½œ
await page.mouse.down();
await page.mouse.move(100, 100);
await page.mouse.up();
```

## è·å–è¯·æ±‚

```js
await page.setRequestInterception(true); // è·å–è¯·æ±‚

page.on("request", (request) => {
  request.url(); // è·å–è¯·æ±‚ç½‘å€
  if (true) {
    request.continue();
  } else {
    request.abort([errorCode]);
  }
});

// è·å–æµè§ˆå™¨ä¿¡æ¯å’Œå†…å®¹
page.$eval(selector, (item) => {
  return item;
});
page.$$eval(selectors, (items) => {
  return items;
});
```

## æˆªå›¾

```js
const puppeteer = require("puppeteer");

const run = async () => {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  await page.setViewport({
    width: 640,
    height: 800,
  });
  await page.goto("http://komavideo.com/");
  await page.screenshot({
    path: "mypic.png",
    fullPage: true,
  });
  await browser.close();
};

run();
```

# ç½‘ç«™ fastify

```js
const fastify = require("fastify")();

fastify.get("/", async () => {
  return { status: "ok" };
});
fastify.listen(4001, () => {
  console.log("server listening at 4001");
});
```

# ç½‘ç«™ express-graphql

```js
const express = require("express");

const graphqlhttp = require("express-graphql"); // npm i express-graphql graphql
const graphqlschema = require("./schema/default.js");

const app = express();
app.use("/graphql", graphqlhttp){ // http://localhost:3000/graphql
  schema: graphqlschema,
  graphiql: true,
}

// schema/default.js æ–‡ä»¶
const DB = require("./model/db.js");
const {
  GraphQLObjectType,
  GraphQLString,
  GraphQLList,
  GraphQLSchema
} = require("graphql");
const CustomSchema = new GraphQLObjectType({
  name: "custom",
  fields: {
    _id: { type: GraphQLString },
    title: { type: GraphQLString }
  }
})
const RootSchema = new GraphQLObjectType({
  name: "root",
  fields: {
    findOne: {
      type: CustomSchema,
      args: { id: { type: GraphQLString } },
      async resolve(parent, args){
        var id = args.id;
        var list = await DB.find("custom", { "_id": DB.getobjectId(id)});
        return list[0];
      }
    },
    findAll: {
      type: GraphQLList(CustomSchema),
      async resolve(parent, args){
        var list = await DB.find("custom", {});
        return list;
      }
    }
  }
})
module.exports = new GraphQLSchema({ query: RootSchema })
```

# ç½‘ç«™ deno

- https://deno.land
- [Servest](https://servestjs.org) DenoWeb æ¡†æ¶

```bash
$ brew install deno # å®‰è£…
$ deno run https://deno.land/std/examples/welcome.ts # æ‰§è¡Œ
$ deno run --allow-net main.ts # èµ‹äºˆæƒé™æ‰§è¡Œ
```

```js
// main.ts å»ºç«‹httpæœåŠ¡

import { serve } from "https://deno.land/std@0.62.0/http/server.ts";

const s = serve({ port: 8000 });
console.log("http://localhost:8000/");
for await (const req of s) {
  req.respond({ body: "Hello World\n" });
}
```

# ç½‘ç«™ adonisjs

```bash
npm i -g @adonisjs/cli

adonis new myproject
cd myproject
adonis serve --dev # å¯åŠ¨

# æ–°å»º app/Controllers/Http/SiteController.js
# ç±»å‹ ForHttpRequestsï¼ŒåŒç† post å’Œ admin/post
adonis make:controller site
adonis make:controller admin/post --resource # è‡ªåŠ¨curd
# æ–°å»º app/Models/Post.jsï¼Œä¿®æ”¹ PostController.js
adonis make:model post
# æ–°å»º resource/views/posts/index.edgeï¼ŒåŒç† post/show.edge
adonis make:view post.index
```

- é¡¹ç›®ç»“æ„ `myproject/`
  - `app/`
    - `Models/`
      - `Post.js` å»º
    - `Controllers/Http/`
      - `SiteController.js` å»º
      - `PostController.js` å»º
      - `Admin/PiteController.js` å»º
  - `start/`
    - `app.js`
    - `routes.js` æ”¹
  - `config/`
  - `database/`
  - `resource/views/`
    - `posts/index.edge` å»º
    - `posts/show.edge` å»º
  - `server.js`
  - `.env.development.local` æ”¹
    - å†…å®¹ `VUE_APP_API_URL=http://localhost:3000/admin/api`
    - å†…å®¹ `VUE_APP_PRIMARY_KEY=_id`

```js
// routes.js
const Route = use("Route");
Route.get("/", "SiteController.index");
Route.get("/posts", "PostController.index");
Route.get("/posts/:id", "PostController.show");
Route.resource("/admin/api/posts", "Admin/PostController"); // è‡ªåŠ¨curd

// SiteController.js
("use strict");
class SiteController {
  index() {
    return "home";
  }
}
module.exports = SiteController;

// PostController.js
("use strict");
const Post = use("App/Models/Post");
class PostController {
  async index({ request, view }) {
    // return "posts" + request.input("page"); // è·å– /posts?page= æ•°æ®
    // await Post.create({ title: "æ ‡é¢˜" });
    const posts = await Post.all();
    return view.render("posts.index", {
      posts: posts.toJSON(),
    });
  }
  async show({ params }) {
    const post = await Post.find(params.id); // è·å– /posts/id æ•°æ®
    return view.render("posts.show", {
      post: post.toJSON(),
    });
  }
}
module.exports = PostController;

// Admin/PostController.js
("use strict");
const Post = use("App/Models/Post");
class PostController {
  // Route.resource å« index create store show edit update destroy
  async index({ request, response, view }) {
    // è·¯ç”± /posts
    return await Post.query().paginate(1, 10);
  }
  async create({ request, response, view }) {
    // è·¯ç”± /posts/create
  }
  async store({ request, response }) {
    // è·¯ç”± POST /posts
    const data = request.only(["title"]);
    const model = new Post();
    model.fill(data);
    await model.save();
    return model;
  }
  async show({ params, request, response, view }) {
    // è·¯ç”± /posts/:id
    return await Post.find(params.id);
  }
  async edit({ params, request, response, view }) {
    // è·¯ç”± /posts/:id/edit
  }
  async update({ params, request, response }) {
    // è·¯ç”± PUTæˆ–PATCH posts/:id
    const data = request.all();
    const model = await Post.find(params.id);
    model.merge(data);
    await model.save();
    return model;
  }
  async destroy({ params, request, response }) {
    // è·¯ç”± DELETE posts/:id
    const model = await Post.find(params.id);
    model.merge(data);
    await model.delete();
    return { success: true };
  }
}
module.exports = PostController;
```

```html
<!-- index.edge -->
<h1>æˆ‘çš„åšå®¢</h1>
<ul>
  @each(post in posts)
  <li><a href="/posts/{{post._id}}">{{post.title}}</a></li>
  @endeach
</ul>

<!-- show.edge -->
<h1>{{post.title}}</h1>
<p>åˆ›å»ºæ—¶é—´ï¼š{{post.created_at}}</p>
```

# ç½‘é¡µ canvas

```html
<canvas id="mainCanvas" width="800" height="600"></canvas>
<script>
  const canvas = document.querySelector("#mainCanvas");
  const ctx = canvas.getContext("2d");

  ctx.fillStyle = "gray"; // ç¬”è®¾ç½®
  ctx.fillRect(50, 150, 100, 200); // çŸ©å½¢ fillRect(x, y, w, h)
  ctx.strokeStyle = "green"; // æè¾¹è®¾ç½®
  ctx.strokeRect(200, 150, 100, 200); // æè¾¹çŸ©å½¢ strokeRect(x, y, w, h)

  ctx.beginPath(); // é‡ç½®ï¼Œæµç¨‹ beginPathã€fillStyleã€fill æˆ– stroke
  ctx.arc(400, 150, 50, 0, Math.PI * 2); // å¼§ arc(x, y, radius, startAngle, endAngle)
  ctx.fillStyle = "gray";
  ctx.fill(); // å¡«å……

  ctx.beginPath();
  ctx.moveTo(500, 250); // ç§»åŠ¨
  ctx.lineTo(600, 350); // çº¿
  ctx.strokeStyle = "blue";
  ctx.stroke(); // æç”»
</script>
```

# å›¾è¡¨ chartjs

```js
(function () {
  "use strict";
  var type = "line"; // bar horizontalBar radar pie(é¥¼å›¾) doughnut(é¥¼å›¾)
  var data = {
    labels: ["a", "b", "c"],
    datasets: [
      {
        label: "name1",
        data: [100, 200, 300],
        borderColor: "red",
        borderWidth: 3,
        fill: false,
        backgroundColor: "rgba(128,0,0,0.5)", // å¯æ•°ç»„
        lineTension: 0, // æ›²åº¦
        pointStyle: "rect", // circle cross crossRot dash line rectRounded rectRot star triangle
        pointRadius: 8,
        type: "line",
        yAxisID: "name1-axes", // çº¿æ£’ç»„åˆ
      },
      {
        label: "name2",
        data: [50, 100, 150],
        type: "bar", // çº¿æ£’ç»„åˆ
        yAxisID: "name2-axes", // çº¿æ£’ç»„åˆ
      },
    ],
  };
  var options = {
    scales: {
      yAxes: [
        {
          stacked: true, // çº¿æ£’ç»„åˆ
          ticks: {
            min: 0,
            max: 2000,
            suggestedMin: 0,
            suggestedMax: 2000,
            stepSize: 400,
            callback: function (value, index, values) {
              return value + "unit";
            },
          },
        },
        {
          id: "name1-axes",
          type: "linear",
          position: "left", // çº¿æ£’ç»„åˆ
          ticks: { min: 0, max: 1800 },
        },
        {
          id: "name2-axes",
          type: "linear",
          position: "right", // çº¿æ£’ç»„åˆ
          ticks: { min: 0, max: 800 },
          gridLines: { display: false }, // çº¿æ£’ç»„åˆ
        },
      ],
      xAxes: [{ stacked: true }],
    },
    title: {
      display: true,
      text: "title",
      fontColor: "green",
      fontSize: "24",
      position: "top", // left bottom right
    },
    legend: { position: "right", diaplay: true },
    animation: { duration: 1000, easing: "easeOutQuart" },
    cutoutPercentage: 20, // é¥¼å›¾
  };
  var ctx = document.getElementById("myChart").getContext("2d");
  var chart = new Chart(ctx, { type: type, data: data, options: options });
  // <script src="/chartjs/Chart.bundle.js"></script>
  // <canvas id="myChart">å›¾è¡¨åŒº</canvas>
})();
```

# æ”¶é›†èµ„æ–™ unirest

```js
var unirest = require("unirest");

var req = unirest("GET", "https://covid-193.p.rapidapi.com/statistics");
req.query({
  country: "USA",
});
req.headers({
  "x-rapidapi-host": "covid-193.p.rapidapi.com",
  "x-rapidapi-key": "key",
  useQueryString: true,
});
req.end(function (res) {
  if (res.error) throw new Error(res.error);
  console.log(JSON.stringify(res.body, null, 3));
});
```

# æœåŠ¡å™¨ nginx

```bash
# è®¾ç½®æ–‡ä»¶
include vhost/*.conf; # nginx.conf çš„ http å—ï¼Œæ¨¡æ‹Ÿè™šæ‹Ÿä¸»æœºï¼Œå¼•ç”¨å…¶ä»–é…ç½®

# è´Ÿè½½å‡è¡¡ï¼Œwww.conf æŠŠæœåŠ¡åœ°å€(åŸŸå)åå‘ä»£ç†åˆ° proxy_pass åœ°å€ï¼Œå³ upstream åœ°å€
upstream localhost {
    server localhost:8080 weight=1; # å•åº”ç”¨éƒ¨ç½²å¤šä¸»æœºæˆ–å¤šåº”ç”¨
    server localhost:8081 weight=1;
}

# åå‘ä»£ç†
# nginx.conf åŒçº§ vhost ç›®å½•ä¸‹ www.conf
server {
    listen 80;
    server_name www.power.com;
    location / {
        proxy_pass http://localhost; # åå‘ä»£ç†
        proxy_connect_timeout 500ms;
    }
}

# é™æ€ä»£ç†ï¼Œä½¿ www.power ç½‘é¡µèƒ½è®¿é—® img.power èµ„æº (z:/ ä¸­)
# nginx.conf åŒçº§ vhost ç›®å½•ä¸‹ img.conf
server {
    listen 80;
    server_name img.power.com; # é™æ€ä»£ç†
    root z:/; # å…±äº«åœ°å€æ˜ å°„ï¼Œimg(\\å…±äº«æ–‡ä»¶ä¸»æœº) æ˜ å°„åˆ° z:/
    location / {
        index index.html;
    }
}

# æœ¬æœº hosts æ–‡ä»¶(æœ¬æœºåŸŸåè§£ææœåŠ¡å™¨ DNS)
127.0.0.1 www.power.com # è´Ÿè½½å‡è¡¡æ¼”ç¤ºç”¨
127.0.0.1 img.power.com # é™æ€ä»£ç†æ¼”ç¤ºç”¨
127.0.0.1 localhost # localhost é»˜è®¤
```
